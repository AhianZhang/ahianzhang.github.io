---
title: "电商搜索技术总结"
date: 2022-03-16T11:47:50+08:00
tags: ["总结"]
categories: ["搜索"]
draft: true
---

# 回顾

本篇文章我们针对于上文”电商搜索业务总结“中的业务需求进行拆解，并以技术角度进行分析。

>- 对于关系好的商户我想把他们的品牌优先展示，增加曝光率
>- 新上架一款商品，我想立即在平台上搜索到
>- 当我使用具体款号搜索时，我希望只展示这一款的商品
>- 我希望在搜索结果页中看到更多的品牌，而不是整页都是同一个品牌
>- 对于有品牌中有奇葩的字符时，我希望搜索能够正常的处理
>- 我希望热词搜索能够展示每日 Top 10 的数据并且支持自定义
>- 搜索建议词要求按“品牌+品类”、“品类+品类”的格式展示
>- 商品撤柜（合同到期）、关网销（不在线上卖）、下架（有问题）时要及时的清除这些商品
>- 针对于搜索结果，我要统计其中品牌品类以及门店的信息
>- 我希望能在搜索时进行价格区间、折扣区间、分类、门店进行过滤
>- 我希望能在搜索时能按上新时间、销量、价格进行排序
>- 我希望在搜索“阿迪“时，能查询到阿迪达斯、阿迪王、三叶草等商品

# 术语

在分析需求前，我先将搜索中常用的术语先列一下，便于后面的展开：

- 文档：结构化的数据，比如一件衣服的数据信息
- 字段：文档中的基本组成部分，一个文档中可包含一个或多个字段
- 索引：根据设置选取某个字段建立倒排索引，和数据库索引意思类似，都是为了加快查询速度
- 组合索引：我们可以将多个字段放到同一个索引中，查询时会同时在这些字段中进行查找
- 分词：总体上讲就是将一个字符串按一定的逻辑拆成几个小的子序列
- 模糊搜索：当搜索意图不明确时，比如只记得几个字，但是不知道全称叫什么情况下使用，模糊搜索会降低精准度
- 短语搜索：希望保持查询的内容相对顺序和位置，这会提高精准度，但是会减少召回数量
- 召回：从索引中返回命中的文档
- 粗排（基础排序）：从海量的索引中取出匹配度高的 TopN 的文档取出 
- 精排（业务排序）：在精排的基础上，根据具体的业务规则进行排序
- 布尔查询：高级搜索功能，利用 OR、AND 等来影响召回数量，多用在过滤条件
- 纠错：将搜索词中有问题的字进行修改替换，比如，”连衣群“纠错后变成“连衣裙”
- 打分：每个文档自身都会有一个分数，分数越高表示越匹配用户输入的内容
- 权重：业务排序参考的部分，比如夏天了，把夏季这个属性的权重调高，那么排序时会优先展示权重高的内容
- 同义词：例如 Adidas 和阿迪达斯
- 停用词：在构建索引时要排除的内容，一般是标点、语气词等助词
- 统计：对查询结果的某个字段进行统计，比如 100 件衣服里是李宁品牌的有几件

# 需求分析

从业务需求中，我们可以宏观上分成个两个部分：查询部分和索引部分，查询部分是我们从输入一个关键字开始到返回查询结果结束之间的内容，那查询的数据从哪来呢，这就是索引部分要做的事情，简单讲就是将我们业务系统中的非结构化的数据转换成需要的结构化数据过程。下面我们展开来讲。

## 索引部分

我们在业务系统中经常会使用 MySQL 进行数据持久化，MySQL 的 InnoDB 存储引擎会使用 B+ 树来存储索引，B+ 树的查询效率已经很高了，那么我们为什么不直接将 MySQL 用作电商搜索呢，这不是本文的重点，但你可以参考这几篇文章

 [ElasticSearch 索引 VS MySQL 索引](https://crossoverjie.top/2020/08/24/elasticsearch/ElasticSearch%20VS%20MySQL/)

 [Elasticsearch 中为什么选择倒排索引而不选择 B 树索引](https://www.cnblogs.com/lonely-wolf/p/15464556.html)

 [倒排索引与数据库索引](https://www.jianshu.com/p/d54f33addaea)



### 数据源

搜索索引的数据一般都是来源于业务系统，在电商领域中分散在多个系统中，主数据（款、色、规、季节、名称、图片），库存，价格，销量，门店，供应商，我们需要将这些属性合并到一个结构中，然后针对需要查询的字段建立合适的索引，这样搜索引擎中就有了索引数据。

此时我们要考虑数据变化后，索引如何更新，商品信息并非一成不变，下单、加购、降价、撤柜等都会带来一系列的变化，那我们如何获取到这些变化呢？





### CDC 服务



### Dump 服务

> - 新上架一款商品，我想立即在平台上搜索到
> - 对于有品牌中有奇葩的字符时，我希望搜索能够正常的处理
> - 商品撤柜（合同到期）、关网销（不在线上卖）、下架（有问题）时要及时的清除这些商品

## 查询部分

用户在输入一个关键字以后，搜索系统内部是如何处理的？









